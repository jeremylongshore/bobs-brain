"""
{{PRODUCT_DISPLAY_NAME}} Orchestrator Agent

TEMPLATE: Replace all {{PARAMETERS}} with your product-specific values.

This is the top-level orchestrator agent for {{PRODUCT_DISPLAY_NAME}}.
Coordinates with the {{FOREMAN_AGENT_NAME}} and provides user-facing interface.

Example replacements:
- {{PRODUCT_NAME}} → "diagnosticpro"
- {{PRODUCT_DISPLAY_NAME}} → "DiagnosticPro"
- {{ORCHESTRATOR_AGENT_NAME}} → "diagnosticbot" or keep as "bob"
- {{FOREMAN_AGENT_NAME}} → "iam-senior-lead"
"""

from google.adk.agents import LlmAgent
from google.adk.sessions import VertexAiSessionService
from google.adk.memory import VertexAiMemoryBankService

# TEMPLATE: Import your product-specific tools
# Example: from agents.tools.diagnosticpro_tools import DiagnosticTool

# TEMPLATE: Configure for your GCP project
PROJECT_ID = "{{PROJECT_ID}}"  # Example: "diagnosticpro-prod"
LOCATION = "{{LOCATION}}"       # Example: "us-central1"

# TEMPLATE: Configure dual memory (Session + Memory Bank)
session_service = VertexAiSessionService(
    project_id=PROJECT_ID,
    location=LOCATION,
)

memory_service = VertexAiMemoryBankService(
    project_id=PROJECT_ID,
    location=LOCATION,
)


def auto_save_session_to_memory(ctx):
    """
    After-agent callback for R5 compliance (Dual Memory).

    Automatically saves session to Memory Bank after each agent run.
    """
    # TEMPLATE: Implement session persistence logic for your product
    # This pattern should remain the same across products
    pass


def get_agent() -> LlmAgent:
    """
    Get the {{ORCHESTRATOR_AGENT_NAME}} orchestrator agent.

    Returns:
        LlmAgent: Configured orchestrator agent with tools and memory

    Example usage:
        agent = get_agent()
        result = agent.run("Audit the codebase for ADK compliance")
    """
    # TEMPLATE: Load system prompt for your product
    with open("agents/{{ORCHESTRATOR_AGENT_NAME}}/system-prompt.md", "r") as f:
        system_prompt = f.read()

    # TEMPLATE: Configure tools for your product
    # Example tools:
    # - RAG tool (if using Vertex AI Search)
    # - Product-specific tools
    # - Foreman delegation tool
    tools = [
        # Add your product-specific tools here
    ]

    return LlmAgent(
        model="gemini-2.0-flash-exp",  # Or your preferred model
        name="{{ORCHESTRATOR_AGENT_NAME}}",
        instruction=system_prompt,
        tools=tools,
        session_service=session_service,
        memory_service=memory_service,
        after_agent_callback=auto_save_session_to_memory,
    )


# Required for ADK CLI deployment
root_agent = get_agent()
