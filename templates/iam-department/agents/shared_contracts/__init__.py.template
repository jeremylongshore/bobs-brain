"""
{{PRODUCT_DISPLAY_NAME}} IAM Department - Shared Contracts

TEMPLATE: These contracts are largely product-agnostic and can be used as-is.
You may add product-specific fields, but keep the core shape.

These contracts define the data shapes exchanged between agents in the pipeline.
"""

from dataclasses import dataclass, field
from typing import List, Literal, Optional, Dict, Any
import uuid


# ==============================================================================
# PIPELINE CONTRACTS
# ==============================================================================


@dataclass
class PipelineRequest:
    """
    Request to execute a software engineering pipeline.

    This contract is sent from {{ORCHESTRATOR_AGENT_NAME}} to {{FOREMAN_AGENT_NAME}}.
    """

    repo_hint: str
    """Repository to analyze (name, URL, or monorepo path)"""

    task_description: str
    """Natural language description of the SWE task"""

    pipeline_run_id: str = field(default_factory=lambda: str(uuid.uuid4()))
    """Unique ID for this pipeline run (for correlation/tracing)"""

    mode: Literal["preview", "dry-run", "create"] = "preview"
    """
    Pipeline mode:
    - preview: Analysis only, no artifacts
    - dry-run: Generate artifacts, no GitHub interaction
    - create: Full pipeline with GitHub issue creation
    """

    env: Literal["dev", "staging", "prod"] = "dev"
    """Target environment"""

    # TEMPLATE: Add product-specific fields here
    # Example:
    # customer_id: Optional[str] = None
    # workspace_id: Optional[str] = None


@dataclass
class PipelineResult:
    """
    Result from executing a software engineering pipeline.

    This contract is returned from {{FOREMAN_AGENT_NAME}} to {{ORCHESTRATOR_AGENT_NAME}}.
    """

    request: PipelineRequest
    """Original request that generated this result"""

    pipeline_run_id: str
    """Correlation ID (copied from request)"""

    issues: List["IssueSpec"]
    """GitHub issue specifications generated"""

    fixes: List["FixPlan"]
    """Fix plans generated (if applicable)"""

    qa_verdicts: List["QAVerdict"]
    """QA validation results"""

    documentation_updates: List[str]
    """Documentation changes made"""

    total_issues_found: int = 0
    """Total issues discovered"""

    issues_fixed: int = 0
    """Issues that were fixed"""

    pipeline_duration_seconds: float = 0.0
    """Total pipeline execution time"""

    error: Optional[str] = None
    """Error message if pipeline failed"""

    # TEMPLATE: Add product-specific result fields here


# ==============================================================================
# ISSUE SPECIFICATION CONTRACT
# ==============================================================================


@dataclass
class IssueSpec:
    """
    Specification for a GitHub issue.

    Generated by iam-issue agent, consumed by GitHub integration.
    """

    title: str
    """Issue title (clear, actionable)"""

    body: str
    """Issue body (markdown, detailed description)"""

    labels: List[str] = field(default_factory=list)
    """GitHub labels (e.g., ["bug", "adk-compliance"])"""

    assignees: List[str] = field(default_factory=list)
    """GitHub usernames to assign"""

    priority: Literal["low", "medium", "high", "critical"] = "medium"
    """Issue priority"""

    category: str = "general"
    """Issue category (e.g., "adk-compliance", "security", "performance")"""

    related_files: List[str] = field(default_factory=list)
    """Files referenced in this issue"""

    # TEMPLATE: Add product-specific issue fields here


# ==============================================================================
# FIX PLAN CONTRACT
# ==============================================================================


@dataclass
class FixPlan:
    """
    Plan for fixing an issue.

    Generated by iam-fix-plan agent, consumed by iam-fix-impl.
    """

    issue_id: str
    """Related issue ID or title"""

    summary: str
    """One-sentence fix summary"""

    approach: str
    """Detailed approach description"""

    files_to_modify: List[str]
    """Files that will be changed"""

    estimated_complexity: Literal["trivial", "simple", "moderate", "complex"] = "simple"
    """Complexity estimate"""

    risks: List[str] = field(default_factory=list)
    """Known risks or concerns"""

    tests_needed: List[str] = field(default_factory=list)
    """Tests to add/modify"""

    # TEMPLATE: Add product-specific fix planning fields here


# ==============================================================================
# QA VERDICT CONTRACT
# ==============================================================================


@dataclass
class QAVerdict:
    """
    Quality assurance verdict.

    Generated by iam-qa agent.
    """

    target: str
    """What was validated (issue, fix, PR, etc.)"""

    verdict: Literal["pass", "fail", "needs-review"]
    """Overall QA result"""

    checks_passed: List[str]
    """Checks that passed"""

    checks_failed: List[str]
    """Checks that failed"""

    warnings: List[str] = field(default_factory=list)
    """Non-blocking warnings"""

    recommendations: List[str] = field(default_factory=list)
    """Improvement recommendations"""

    # TEMPLATE: Add product-specific QA fields here


# ==============================================================================
# REPOSITORY CONTEXT CONTRACT
# ==============================================================================


@dataclass
class RepoContext:
    """
    Repository metadata and context.

    Used by agents to understand the repository structure.
    """

    repo_name: str
    """Repository name"""

    repo_path: str
    """Local path or URL"""

    primary_language: str
    """Primary programming language"""

    frameworks: List[str] = field(default_factory=list)
    """Frameworks used (e.g., ["FastAPI", "React"])"""

    key_directories: Dict[str, str] = field(default_factory=dict)
    """Important directories (e.g., {"agents": "agents/", "tests": "tests/"})"""

    # TEMPLATE: Add product-specific repository metadata here


# ==============================================================================
# TEMPLATE: Add your product-specific contracts here
# ==============================================================================

# Example:
# @dataclass
# class DiagnosticResult:
#     """Product-specific diagnostic result"""
#     diagnostic_id: str
#     severity: str
#     recommendations: List[str]
