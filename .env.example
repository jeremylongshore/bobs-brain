# Bob's Brain - Environment Configuration Template
# Copy this file to .env and fill in your values
# Last Updated: 2025-11-20

# ============================================================================
# Required Configuration (R1-R8)
# ============================================================================

# Environment Selection (auto-detected from PROJECT_ID if not set)
# Options: dev, staging, prod
# Used for config validation and feature gating
DEPLOYMENT_ENV=dev

# Google Cloud Project Configuration (R2: Agent Engine)
PROJECT_ID=your-gcp-project-id
LOCATION=us-central1
AGENT_ENGINE_ID=your-agent-engine-id

# Agent Identity (R7: SPIFFE ID)
# Format: spiffe://intent.solutions/agent/bobs-brain/<env>/<region>/<version>
AGENT_SPIFFE_ID=spiffe://intent.solutions/agent/bobs-brain/dev/us-central1/0.6.0

# Application Configuration
APP_NAME=bobs-brain
APP_VERSION=0.6.0

# ============================================================================
# RAG Configuration (Phase RC1: Centralized RAG Config)
# ============================================================================

# Environment Selection (auto-detected if not set)
# DEPLOYMENT_ENV=dev  # Options: dev, staging, prod

# Vertex AI Search - Common Configuration
VERTEX_SEARCH_PROJECT_ID=your-gcp-project-id
VERTEX_SEARCH_LOCATION=global  # or us-central1, etc.

# Vertex AI Search - Environment-Specific Datastore IDs
# Dev: Development/testing datastore
VERTEX_SEARCH_DATASTORE_ID_DEV=adk-documentation-dev

# Staging: Pre-production datastore
VERTEX_SEARCH_DATASTORE_ID_STAGING=adk-documentation-staging

# Production: Live datastore (careful!)
VERTEX_SEARCH_DATASTORE_ID_PROD=adk-documentation-prod

# Note: Datastores created by scripts/setup_vertex_search.sh

# ============================================================================
# Feature Flags (LIVE1-3, RAG, Agent Engine, Blue/Green)
# ============================================================================

# RAG Feature Flags (LIVE2)
# Enable Vertex AI Search for specific agents (default: disabled)
LIVE_RAG_BOB_ENABLED=false
LIVE_RAG_FOREMAN_ENABLED=false

# Agent Engine A2A Flags (LIVE2)
# Enable foreman → iam-* calls via Agent Engine (vs local execution)
ENGINE_MODE_FOREMAN_TO_IAM_ADK=false
ENGINE_MODE_FOREMAN_TO_IAM_ISSUE=false
ENGINE_MODE_FOREMAN_TO_IAM_FIX=false

# Gateway Routing Flags
# Enable Slack → a2a_gateway → Agent Engine (Option B routing)
SLACK_SWE_PIPELINE_MODE_ENABLED=false

# Blue/Green Migration Flags (Bob Current → Next-Gen)
# Enable routing to Bob next-gen (ADK-based)
AGENT_ENGINE_BOB_NEXT_GEN_ENABLED=false
AGENT_ENGINE_BOB_NEXT_GEN_PERCENT=0  # Traffic percentage (0-100)
BLUE_GREEN_SHADOW_TRAFFIC_ENABLED=false

# ============================================================================
# Org Storage Configuration (LIVE1-GCS)
# ============================================================================

# Enable writing portfolio/SWE results to org-wide GCS bucket (default: disabled)
ORG_STORAGE_WRITE_ENABLED=false

# Org-wide GCS bucket for knowledge hub
# Format: intent-org-knowledge-hub-{env}
# ORG_STORAGE_BUCKET=intent-org-knowledge-hub-dev

# ============================================================================
# Service Configuration (R3: Gateway URLs)
# ============================================================================

# A2A Gateway Public URL (for AgentCard)
PUBLIC_URL=https://your-a2a-gateway.run.app

# Slack Webhook URL (optional - for Slack integration)
SLACK_WEBHOOK_URL=https://your-slack-webhook.run.app

# ============================================================================
# Google Cloud Authentication (R4: CI-Only Deployments)
# ============================================================================

# NOTE: Never set GOOGLE_APPLICATION_CREDENTIALS for production deployments!
# Production uses Workload Identity Federation (WIF) in GitHub Actions.
# Only set this for local development/testing.
#
# GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json

# ============================================================================
# Slack Bot Integration (Dev) - Talk to Bob in Slack
# ============================================================================

# Enable Slack bot interaction (talk to Bob via @mentions)
# SAFETY: Disabled by default, enable for dev testing
# Set to "true" to allow talking to Bob in Slack
SLACK_BOB_ENABLED=false

# Slack Bot Token (starts with xoxb-)
# Required when SLACK_BOB_ENABLED=true
# Get from: https://api.slack.com/apps → OAuth & Permissions
SLACK_BOT_TOKEN=xoxb-your-bot-token-here

# Slack Signing Secret (for webhook verification)
# Required when SLACK_BOB_ENABLED=true
# Get from: https://api.slack.com/apps → Basic Information
SLACK_SIGNING_SECRET=your-signing-secret-here

# Slack App ID (for reference)
SLACK_APP_ID=A099YKLCM1N

# A2A Gateway URL (for Slack → Agent Engine routing)
# Required when SLACK_BOB_ENABLED=true
# Format: https://a2a-gateway-{SERVICE_HASH}-uc.a.run.app
# A2A_GATEWAY_URL=https://a2a-gateway-eow2wytafa-uc.a.run.app

# ============================================================================
# LIVE3A: Slack Notifications (Portfolio SWE Audits)
# ============================================================================

# Enable Slack notifications for portfolio/SWE completion (LIVE3A)
# SAFETY: Notifications are DISABLED by default
# Set to "true" only when you want to receive Slack notifications
SLACK_NOTIFICATIONS_ENABLED=false

# Slack Webhook URL for SWE/Portfolio notifications (LIVE3A)
# Preferred method: incoming webhook (no bot token required)
# Get from: https://api.slack.com/messaging/webhooks
# SLACK_SWE_CHANNEL_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# Alternative: Slack Channel ID (requires SLACK_BOT_TOKEN above)
# Format: C01234567 (found in Slack channel details)
# SLACK_SWE_CHANNEL_ID=C01234567

# Note: Use webhook URL (preferred) OR channel ID, not both

# ============================================================================
# GitHub Integration (Phase GH)
# ============================================================================

# GitHub Personal Access Token (for read and write operations)
# Required for fetching repo contents and creating issues
# Scopes needed: repo (or public_repo for public repos only)
# GITHUB_TOKEN=ghp_your_token_here

# GitHub Issue Creation Feature Flag (Phase GHC)
# SAFETY: Issue creation is DISABLED by default
# Set to "true" only when you want to allow actual issue creation
GITHUB_ISSUE_CREATION_ENABLED=false

# GitHub Issue Creation Allowlist (Phase GHC)
# Comma-separated list of repo IDs (from config/repos.yaml)
# Examples:
#   - Specific repos: bobs-brain,test-repo
#   - All repos (use with caution!): *
#   - No repos (default): (empty)
GITHUB_ISSUE_CREATION_ALLOWED_REPOS=

# GitHub Issue Dry-Run Mode (LIVE3B)
# When true: Log issues but don't actually create them via API
# When false: Create real GitHub issues (requires GITHUB_TOKEN)
# SAFETY: Dry-run is ENABLED by default
GITHUB_ISSUES_DRY_RUN=true

# ============================================================================
# LIVE3 Staging Configuration (Phase LIVE3-STAGE-PROD-SAFETY)
# ============================================================================

# Environment-Aware Safety Gates for Staging/Prod
#
# BEHAVIOR MATRIX:
# - dev: Slack/GitHub enabled if flags set + config valid
# - staging: DISABLED unless explicit override flags below are true
# - prod: DISABLED unless explicit override flags below are true
#
# This prevents accidentally spamming production without explicit approval.

# --- Slack Staging Override ---
# Allow Slack notifications in staging environment
# SAFETY: Requires SLACK_NOTIFICATIONS_ENABLED=true AND webhook configured
# Use case: Testing Slack workflow in staging before prod
# SLACK_ENABLE_STAGING=false

# --- Slack Production Override ---
# Allow Slack notifications in production environment
# SAFETY: Requires SLACK_NOTIFICATIONS_ENABLED=true AND webhook configured
# Use case: Production Slack notifications (use with caution)
# SLACK_ENABLE_PROD=false

# --- Slack Environment Label ---
# Optional prefix for Slack messages (auto-generated if not set)
# Examples: "QA", "STAGING", "PROD-CANARY"
# Auto-generated: "[DEV]", "[STAGING]", "[PROD]"
# SLACK_ENV_LABEL=

# --- GitHub Staging Override ---
# Allow real GitHub issue creation in staging
# SAFETY: Requires GITHUB_ISSUE_CREATION_ENABLED=true AND GITHUB_ISSUES_DRY_RUN=false
# Use case: Testing GitHub issue creation in staging repos
# GITHUB_ENABLE_STAGING=false

# --- GitHub Production Override ---
# Allow real GitHub issue creation in production
# SAFETY: Requires GITHUB_ISSUE_CREATION_ENABLED=true AND GITHUB_ISSUES_DRY_RUN=false
# Use case: Production GitHub issue creation (use with extreme caution)
# GITHUB_ENABLE_PROD=false

# ============================================================================
# Staging Configuration Example (Copy to .env for staging environment)
# ============================================================================
#
# # Environment
# DEPLOYMENT_ENV=staging
#
# # Slack (staging notifications)
# SLACK_NOTIFICATIONS_ENABLED=true
# SLACK_ENABLE_STAGING=true
# SLACK_SWE_CHANNEL_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/STAGING/WEBHOOK
# SLACK_ENV_LABEL=STAGING
#
# # GitHub (dry-run only in staging by default)
# GITHUB_ISSUE_CREATION_ENABLED=true
# GITHUB_ISSUES_DRY_RUN=true
# GITHUB_ENABLE_STAGING=true
# GITHUB_ISSUE_CREATION_ALLOWED_REPOS=bobs-brain
# # GITHUB_TOKEN=ghp_your_token  # Only needed if DRY_RUN=false
#
# # Org Storage (staging bucket)
# ORG_STORAGE_WRITE_ENABLED=true
# ORG_STORAGE_BUCKET=intent-org-knowledge-hub-staging
#
# ============================================================================

# ============================================================================
# Development/Testing Configuration
# ============================================================================

# CI Environment (auto-set by GitHub Actions)
# GITHUB_ACTIONS=true

# Log Level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# ============================================================================
# Hard Mode Rules Enforcement
# ============================================================================

# R1: Agent Implementation - google-adk only (enforced in code)
# R2: Runtime - Vertex AI Agent Engine (PROJECT_ID + AGENT_ENGINE_ID required)
# R3: Cloud Run Role - Gateways only (service/ must NOT import Runner)
# R4: CI-Only Deploys - No manual gcloud (enforced in CI)
# R5: Dual Memory - Session + Memory Bank (enforced in my_agent/agent.py)
# R6: Single 000-docs/ - All docs in one place (enforced in structure)
# R7: SPIFFE ID - Immutable agent tag (AGENT_SPIFFE_ID required)
# R8: Drift Detection - CI scans for violations (enforced in CI)

# ============================================================================
# Environment-Specific Examples
# ============================================================================

# Development Environment
# AGENT_SPIFFE_ID=spiffe://intent.solutions/agent/bobs-brain/dev/us-central1/0.6.0
# PUBLIC_URL=http://localhost:8080

# Staging Environment
# AGENT_SPIFFE_ID=spiffe://intent.solutions/agent/bobs-brain/staging/us-central1/0.6.0
# PUBLIC_URL=https://bobs-brain-staging-a2a.run.app

# Production Environment
# AGENT_SPIFFE_ID=spiffe://intent.solutions/agent/bobs-brain/prod/us-central1/0.6.0
# PUBLIC_URL=https://bobs-brain-a2a.run.app

# ============================================================================
# Notes
# ============================================================================

# 1. Never commit .env to git (it's in .gitignore)
# 2. Production values are managed by Terraform (infra/)
# 3. GitHub Actions uses WIF + secrets (no service account keys)
# 4. SPIFFE ID format must follow: spiffe://<trust-domain>/agent/<name>/<env>/<region>/<version>
# 5. All environment variables are validated at runtime in my_agent/agent.py
